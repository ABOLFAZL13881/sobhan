<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>محصولات | Aura Style فروشگاه پوشاک</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Reset و تنظیمات پایه */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Vazirmatn', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #7c3aed;
            --primary-light: #8b5cf6;
            --primary-dark: #5b21b6;
            --secondary: #f59e0b;
            --secondary-light: #fbbf24;
            --dark: #1f2937;
            --dark-light: #374151;
            --light: #f8fafc;
            --gray: #6b7280;
            --gray-light: #e5e7eb;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 12px 40px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --radius: 16px;
            --radius-sm: 10px;
        }

        body {
            background-color: #fefefe;
            color: var(--dark);
            line-height: 1.7;
            overflow-x: hidden;
            padding-top: 80px;
        }

        /* هدر */
        .header {
            background: white;
            box-shadow: var(--shadow);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            padding: 0.8rem 0;
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 1.5rem;
            max-width: 1400px;
            margin: 0 auto;
            gap: 1rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            flex-shrink: 0;
        }

        .logo i {
            color: var(--secondary);
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.3rem;
            color: var(--dark);
            cursor: pointer;
            padding: 0.5rem;
        }

        .nav-links {
            display: flex;
            gap: 1rem;
            list-style: none;
            transition: var(--transition);
        }

        .nav-links a {
            color: var(--dark);
            text-decoration: none;
            font-weight: 600;
            padding: 0.5rem 0.8rem;
            border-radius: var(--radius-sm);
            transition: var(--transition);
            position: relative;
            font-size: 0.95rem;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: var(--primary);
            background-color: rgba(124, 58, 237, 0.08);
        }

        .nav-links a.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            right: 50%;
            transform: translateX(50%);
            width: 6px;
            height: 6px;
            background-color: var(--primary);
            border-radius: 50%;
        }

        .search-container {
            position: relative;
            flex: 1;
            max-width: 500px;
            margin: 0 1rem;
        }

        .search-box {
            width: 100%;
            padding: 0.7rem 1rem;
            padding-right: 3rem;
            border: 2px solid var(--gray-light);
            border-radius: 50px;
            font-size: 0.95rem;
            transition: var(--transition);
            background-color: var(--light);
        }

        .search-box:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
        }

        .search-icon {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow);
            margin-top: 0.5rem;
            display: none;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1001;
        }

        .search-suggestion-item {
            padding: 0.8rem 1rem;
            border-bottom: 1px solid var(--gray-light);
            cursor: pointer;
            transition: var(--transition);
        }

        .search-suggestion-item:hover {
            background-color: rgba(124, 58, 237, 0.05);
        }

        .search-suggestion-item:last-child {
            border-bottom: none;
        }

        .nav-icons {
            display: flex;
            gap: 0.8rem;
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        .nav-icons i {
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: var(--transition);
            color: var(--dark);
            position: relative;
        }

        .nav-icons i:hover {
            background-color: rgba(124, 58, 237, 0.1);
            color: var(--primary);
        }

        .cart-badge, .wishlist-badge, .compare-badge {
            background-color: var(--secondary);
            color: white;
            font-size: 0.65rem;
            padding: 2px 6px;
            border-radius: 50%;
            position: absolute;
            top: -3px;
            right: -3px;
            font-weight: 700;
            min-width: 18px;
            text-align: center;
        }

        .wishlist-badge {
            background-color: var(--danger);
        }

        .compare-badge {
            background-color: var(--info);
        }

        /* فیلترهای موبایل */
        .mobile-filters {
            display: none;
            justify-content: space-between;
            padding: 0.8rem 1rem;
            background: white;
            border-bottom: 1px solid var(--gray-light);
            position: sticky;
            top: 70px;
            z-index: 999;
            overflow-x: auto;
            gap: 0.5rem;
            -webkit-overflow-scrolling: touch;
        }

        .mobile-filter-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: none;
            border: none;
            color: var(--dark);
            font-size: 0.8rem;
            padding: 0.4rem 0.5rem;
            border-radius: var(--radius-sm);
            transition: var(--transition);
            cursor: pointer;
            min-width: 60px;
            flex-shrink: 0;
        }

        .mobile-filter-btn i {
            font-size: 1rem;
            margin-bottom: 3px;
        }

        .mobile-filter-btn.active {
            color: var(--primary);
            background-color: rgba(124, 58, 237, 0.08);
        }

        /* دکمه فیلتر موبایل (جدید) */
        .mobile-filter-main-btn {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 20px;
            background-color: var(--primary);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(124, 58, 237, 0.3);
            z-index: 998;
            transition: var(--transition);
        }

        .mobile-filter-main-btn:hover {
            transform: scale(1.1);
        }

        .mobile-filter-main-btn .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--danger);
            color: white;
            font-size: 0.7rem;
            padding: 3px 7px;
            border-radius: 50%;
            min-width: 20px;
            text-align: center;
        }

        /* کنتینر اصلی */
        .products-container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem;
            gap: 1.5rem;
            position: relative;
        }

        /* سایدبار فیلتر (دسکتاپ) */
        .filter-sidebar {
            flex: 0 0 260px;
            background: white;
            border-radius: var(--radius);
            padding: 1.2rem;
            box-shadow: var(--shadow);
            height: fit-content;
            position: sticky;
            top: 100px;
            max-height: calc(100vh - 120px);
            overflow-y: auto;
            transition: transform 0.3s ease;
        }

        .filter-sidebar-mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1100;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .filter-sidebar-mobile-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .filter-sidebar-mobile {
            position: fixed;
            top: 0;
            right: -100%;
            bottom: 0;
            width: 85%;
            max-width: 350px;
            background: white;
            z-index: 1200;
            overflow-y: auto;
            padding: 1.5rem;
            transition: right 0.3s ease;
            box-shadow: -5px 0 20px rgba(0, 0, 0, 0.15);
        }

        .filter-sidebar-mobile.active {
            right: 0;
        }

        .close-filter-btn {
            position: absolute;
            top: 15px;
            left: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--dark);
            cursor: pointer;
            z-index: 1;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255,255,255,0.9);
        }

        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.2rem;
            padding-bottom: 0.8rem;
            border-bottom: 2px solid var(--gray-light);
        }

        .filter-header h2 {
            font-size: 1.2rem;
            color: var(--dark);
        }

        .clear-filters {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 0.85rem;
            cursor: pointer;
            transition: var(--transition);
            padding: 0.3rem 0.5rem;
            border-radius: var(--radius-sm);
        }

        .clear-filters:hover {
            color: var(--primary-dark);
            background-color: rgba(124, 58, 237, 0.08);
        }

        .filter-group {
            margin-bottom: 1.5rem;
        }

        .filter-group h3 {
            font-size: 0.95rem;
            color: var(--dark);
            margin-bottom: 0.7rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .filter-count {
            background-color: var(--primary);
            color: white;
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 10px;
        }

        .price-range {
            margin-top: 1rem;
        }

        .price-inputs {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 0.8rem;
            margin-bottom: 1rem;
        }

        .price-input {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius-sm);
            text-align: center;
            font-family: inherit;
            font-size: 0.9rem;
        }

        .price-slider {
            width: 100%;
            height: 6px;
            background: var(--gray-light);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }

        .price-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        /* فیلتر رنگ */
        .color-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 0.5rem;
        }

        .color-option {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: var(--transition);
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        /* پالت رنگی در هاور */
        .product-card:hover .color-palette {
            opacity: 1;
            visibility: visible;
        }

        .color-palette {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 4px;
            background: rgba(255, 255, 255, 0.95);
            padding: 8px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .color-palette-item {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition);
        }

        .color-palette-item:hover {
            transform: scale(1.2);
            border-color: var(--primary);
        }

        /* دکمه سفارشی سازی */
        .customize-btn {
            position: absolute;
            bottom: 15px;
            right: 15px;
            background: linear-gradient(135deg, var(--secondary), var(--secondary-light));
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.8rem;
            cursor: pointer;
            opacity: 0;
            transition: var(--transition);
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
            white-space: nowrap;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .product-card:hover .customize-btn {
            opacity: 1;
            bottom: 20px;
        }

        .customize-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
        }

        .color-option.selected {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px white, 0 0 0 4px var(--primary);
        }

        .color-option.selected::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        /* رنگ‌های پالت */
        .color-black { background-color: #000000; }
        .color-white { background-color: #ffffff; border: 1px solid #ddd; }
        .color-red { background-color: #dc2626; }
        .color-blue { background-color: #2563eb; }
        .color-green { background-color: #16a34a; }
        .color-yellow { background-color: #f59e0b; }
        .color-purple { background-color: #9333ea; }
        .color-gray { background-color: #6b7280; }
        .color-pink { background-color: #ec4899; }
        .color-brown { background-color: #92400e; }

        .size-options {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 0.5rem;
        }

        .size-option {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--gray-light);
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            background: white;
            font-size: 0.9rem;
        }

        .size-option:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .size-option.selected {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
            margin-top: 0.5rem;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--dark-light);
        }

        .custom-checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid var(--gray-light);
            border-radius: 5px;
            margin-left: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            flex-shrink: 0;
        }

        .checkbox-label input {
            display: none;
        }

        .checkbox-label input:checked + .custom-checkbox {
            background-color: var(--primary);
            border-color: var(--primary);
        }

        .checkbox-label input:checked + .custom-checkbox::after {
            content: '✓';
            color: white;
            font-size: 0.7rem;
            font-weight: bold;
        }

        /* بخش محصولات */
        .products-section {
            flex: 1;
            min-width: 0;
        }

        .products-header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--gray-light);
        }

        .products-header h1 {
            font-size: 1.5rem;
            color: var(--dark);
        }

        .sorting-options {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            flex-wrap: wrap;
        }

        .sort-select {
            padding: 0.5rem 0.8rem;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius-sm);
            background-color: white;
            font-family: inherit;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .view-options {
            display: flex;
            gap: 0.3rem;
        }

        .view-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius-sm);
            background: white;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .view-btn:hover,
        .view-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* گرید محصولات */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .products-grid.list-view {
            grid-template-columns: 1fr;
        }

        .product-card {
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            animation: fadeIn 0.5s ease;
        }

        .products-grid.list-view .product-card {
            display: flex;
            flex-direction: row;
            height: auto;
            min-height: 200px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .product-image-container {
            position: relative;
            height: 220px;
            overflow: hidden;
        }

        .products-grid.list-view .product-image-container {
            flex: 0 0 200px;
            height: auto;
            align-self: stretch;
        }

        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.6s ease;
        }

        .product-card:hover .product-image {
            transform: scale(1.05);
        }

        .product-badges {
            position: absolute;
            top: 12px;
            right: 12px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .product-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 700;
            color: white;
        }

        .badge-sale {
            background-color: var(--danger);
        }

        .badge-new {
            background-color: var(--success);
        }

        .badge-popular {
            background-color: var(--secondary);
        }

        .product-actions {
            position: absolute;
            top: 12px;
            left: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            opacity: 0;
            transition: var(--transition);
        }

        .product-card:hover .product-actions {
            opacity: 1;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            color: var(--dark);
        }

        .action-btn:hover {
            background-color: var(--primary);
            color: white;
            transform: scale(1.1);
        }

        .action-btn.active {
            background-color: var(--primary);
            color: white;
        }

        .quick-view-btn {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            opacity: 0;
            transition: var(--transition);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            white-space: nowrap;
        }

        .product-card:hover .quick-view-btn {
            opacity: 1;
            bottom: 20px;
        }

        .product-info {
            padding: 1.2rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .products-grid.list-view .product-info {
            padding: 1.2rem 1.5rem;
        }

        .product-category {
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 0.4rem;
            display: block;
        }

        .product-title {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--dark);
            line-height: 1.4;
        }

        .product-description {
            font-size: 0.85rem;
            color: var(--dark-light);
            margin-bottom: 0.8rem;
            line-height: 1.6;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            flex-grow: 1;
        }

        .products-grid.list-view .product-description {
            -webkit-line-clamp: 3;
            margin-bottom: 1rem;
        }

        .product-rating {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 0.8rem;
        }

        .stars {
            color: var(--secondary);
            font-size: 0.85rem;
        }

        .rating-count {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .product-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
        }

        .product-price {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .current-price {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--primary);
        }

        .old-price {
            font-size: 0.85rem;
            color: var(--gray);
            text-decoration: line-through;
        }

        .add-to-cart-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
        }

        .add-to-cart-btn:hover {
            background-color: var(--primary-dark);
            transform: scale(1.1);
        }

        .add-to-cart-btn.added {
            background-color: var(--success);
            transform: scale(1.1);
        }

        /* پینت‌لود محصولات */
        .skeleton-loader {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: var(--radius);
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton-image {
            height: 220px;
            width: 100%;
        }

        .skeleton-text {
            height: 16px;
            margin: 8px;
            border-radius: 4px;
        }

        .skeleton-text.short {
            width: 60%;
        }

        /* پنل مشاهده سریع */
        .quick-view-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            padding: 1rem;
        }

        .quick-view-panel.active {
            opacity: 1;
            visibility: visible;
        }

        .quick-view-content {
            background: white;
            border-radius: var(--radius);
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            transform: translateY(30px);
            transition: transform 0.4s ease;
        }

        .quick-view-panel.active .quick-view-content {
            transform: translateY(0);
        }

        .close-quick-view {
            position: absolute;
            top: 15px;
            left: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--dark);
            cursor: pointer;
            z-index: 1;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255,255,255,0.9);
        }

        /* پنل مقایسه */
        .compare-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            z-index: 999;
            padding: 1rem;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .compare-panel.active {
            transform: translateY(0);
        }

        .compare-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .compare-products {
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            padding: 0.5rem 0;
        }

        .compare-product {
            flex: 0 0 120px;
            text-align: center;
            position: relative;
        }

        .compare-product img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: var(--radius-sm);
        }

        .remove-compare {
            position: absolute;
            top: -8px;
            left: -8px;
            background: var(--danger);
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            font-size: 0.8rem;
            cursor: pointer;
        }

        /* پاگیشن و لود بیشتر */
        .load-more-container {
            display: flex;
            justify-content: center;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--gray-light);
        }

        .load-more-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .load-more-btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .load-more-btn.loading {
            opacity: 0.7;
            cursor: not-allowed;
        }

        /* نوتیفیکیشن */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--radius);
            z-index: 3000;
            box-shadow: var(--shadow-hover);
            animation: slideIn 0.3s ease;
            max-width: 350px;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* حالت تاریک */
        .dark-mode-toggle {
            position: fixed;
            bottom: 80px;
            left: 20px;
            background-color: var(--primary);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow);
            z-index: 100;
            font-size: 1.1rem;
            transition: var(--transition);
        }

        .dark-mode-toggle:hover {
            transform: scale(1.1);
        }

        body.dark-mode {
            background-color: #121212;
            color: #e0e0e0;
        }

        body.dark-mode .header {
            background-color: #1e1e1e;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        body.dark-mode .product-card,
        body.dark-mode .filter-sidebar {
            background-color: #1e1e1e;
            color: #e0e0e0;
        }

        body.dark-mode .nav-links a {
            color: #e0e0e0;
        }

        body.dark-mode .search-box {
            background-color: #2d2d2d;
            border-color: #444;
            color: #e0e0e0;
        }

        body.dark-mode .sort-select,
        body.dark-mode .view-btn,
        body.dark-mode .price-input {
            background-color: #2d2d2d;
            border-color: #444;
            color: #e0e0e0;
        }

        /* ریسپانسیو */
        @media (max-width: 1200px) {
            .products-container {
                padding: 1.2rem;
            }
            
            .filter-sidebar {
                flex: 0 0 240px;
            }
        }

        @media (max-width: 992px) {
            .products-container {
                flex-direction: column;
            }
            
            .filter-sidebar {
                display: none;
            }
            
            .filter-sidebar-mobile-overlay,
            .filter-sidebar-mobile {
                display: block;
            }
            
            .mobile-filters {
                display: flex;
            }
            
            .mobile-filter-main-btn {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .nav-links {
                position: fixed;
                top: 70px;
                right: -100%;
                background: white;
                flex-direction: column;
                width: 250px;
                padding: 1rem;
                box-shadow: var(--shadow);
                border-radius: 0 0 0 var(--radius);
                z-index: 1001;
                transition: right 0.3s ease;
            }
            
            .nav-links.active {
                right: 0;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .search-container {
                order: 3;
                flex: 0 0 100%;
                margin: 0.5rem 0 0 0;
                max-width: none;
            }
            
            .nav-container {
                flex-wrap: wrap;
            }
            
            /* نمایش لیست در موبایل */
            .products-grid.list-view .product-card {
                flex-direction: column;
                height: auto;
            }
            
            .products-grid.list-view .product-image-container {
                flex: 0 0 auto;
                height: 200px;
            }
            
            .dark-mode-toggle {
                bottom: 100px;
            }
        }

        @media (max-width: 768px) {
            .nav-container {
                padding: 0 1rem;
            }
            
            .products-container {
                padding: 1rem;
            }
            
            .products-header {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }
            
            .sorting-options {
                justify-content: space-between;
                width: 100%;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
                gap: 1rem;
            }
            
            .product-image-container {
                height: 200px;
            }
            
            .quick-view-content {
                max-height: 80vh;
            }
            
            .compare-panel {
                padding: 0.8rem;
            }
            
            .compare-product {
                flex: 0 0 100px;
            }
            
            .products-grid.list-view .product-card {
                flex-direction: column;
            }
            
            .filter-sidebar-mobile {
                width: 90%;
                max-width: 320px;
            }
            
            .mobile-filter-main-btn {
                width: 55px;
                height: 55px;
                font-size: 1.1rem;
            }
        }

        @media (max-width: 576px) {
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .product-card {
                max-width: 100%;
            }
            
            .price-inputs {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .price-input {
                width: 100%;
            }
            
            .dark-mode-toggle {
                bottom: 95px;
                left: 15px;
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }
            
            .logo {
                font-size: 1.3rem;
            }
            
            .nav-icons {
                gap: 0.5rem;
            }
            
            .mobile-filter-btn {
                min-width: 50px;
                font-size: 0.7rem;
                padding: 0.3rem;
            }
            
            .mobile-filter-btn i {
                font-size: 0.9rem;
            }
            
            /* تنظیمات حالت لیست در موبایل */
            .products-grid.list-view .product-card {
                flex-direction: column;
            }
            
            .products-grid.list-view .product-image-container {
                height: 200px;
                width: 100%;
            }
            
            .products-grid.list-view .product-info {
                padding: 1rem;
            }
            
            .filter-sidebar-mobile {
                width: 95%;
                max-width: 300px;
                padding: 1.2rem;
            }
            
            .mobile-filter-main-btn {
                bottom: 15px;
                left: 15px;
                width: 50px;
                height: 50px;
            }
        }

        @media (max-width: 480px) {
            .products-grid.list-view .product-image-container {
                height: 180px;
            }
            
            .mobile-filter-btn {
                min-width: 45px;
                font-size: 0.65rem;
            }
            
            .mobile-filter-main-btn {
                width: 45px;
                height: 45px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- هدر -->
    <header class="header">
        <div class="nav-container">
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            
            <a href="#" class="logo">
                <i class="fas fa-crown"></i>
                <span>Aura Style</span>
            </a>
            
            <ul class="nav-links">
                <li><a href="#">خانه</a></li>
                <li><a href="#" class="active">محصولات</a></li>
                <li><a href="#">دسته‌بندی‌ها</a></li>
                <li><a href="#">تخفیف‌ها</a></li>
                <li><a href="#">درباره ما</a></li>
            </ul>
            
            <div class="search-container">
                <input type="text" class="search-box" id="searchBox" placeholder="جستجوی محصولات...">
                <i class="fas fa-search search-icon"></i>
                <div class="search-suggestions" id="searchSuggestions"></div>
            </div>
            
            <div class="nav-icons">
                <div style="position: relative;">
                    <i class="fas fa-user"></i>
                </div>
                <div style="position: relative;">
                    <i class="fas fa-heart" id="wishlistBtn"></i>
                    <span class="wishlist-badge" id="wishlistCount">0</span>
                </div>
                <div style="position: relative;">
                    <i class="fas fa-balance-scale" id="compareBtn"></i>
                    <span class="compare-badge" id="compareCount">0</span>
                </div>
                <div style="position: relative;">
                    <i class="fas fa-shopping-bag" id="cartBtn"></i>
                    <span class="cart-badge" id="cartCount">3</span>
                </div>
            </div>
        </div>
    </header>

    <!-- فیلترهای موبایل -->
    <div class="mobile-filters">
        <button class="mobile-filter-btn active" data-filter="all">
            <i class="fas fa-th-large"></i>
            <span class="filter-text">همه</span>
        </button>
        <button class="mobile-filter-btn" data-filter="men">
            <i class="fas fa-male"></i>
            <span class="filter-text">مردانه</span>
        </button>
        <button class="mobile-filter-btn" data-filter="women">
            <i class="fas fa-female"></i>
            <span class="filter-text">زنانه</span>
        </button>
        <button class="mobile-filter-btn" data-filter="sale">
            <i class="fas fa-tag"></i>
            <span class="filter-text">حراج</span>
        </button>
        <button class="mobile-filter-btn" id="mobileFilterBtnNav">
            <i class="fas fa-filter"></i>
            <span class="filter-text">فیلترها</span>
        </button>
        <button class="mobile-filter-btn" id="sortBtn">
            <i class="fas fa-sort-amount-down"></i>
            <span class="filter-text">مرتب‌سازی</span>
        </button>
    </div>

    <!-- دکمه فیلتر موبایل (ثابت) -->
    <button class="mobile-filter-main-btn" id="mobileFilterMainBtn">
        <i class="fas fa-filter"></i>
        <span class="badge" id="filterBadge">0</span>
    </button>

    <!-- محتوای اصلی -->
    <main class="products-container">
        <!-- سایدبار فیلتر (دسکتاپ) -->
        <aside class="filter-sidebar" id="filterSidebar">
            <div class="filter-header">
                <h2>فیلتر محصولات</h2>
                <button class="clear-filters" id="clearFilters">
                    پاک کردن
                </button>
            </div>
            
            <!-- دسته‌بندی -->
            <div class="filter-group">
                <h3>دسته‌بندی <span class="filter-count" id="categoryCount">0</span></h3>
                <div class="checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="category" value="men" data-filter="category">
                        <span class="custom-checkbox"></span>
                        مردانه
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="category" value="women" data-filter="category">
                        <span class="custom-checkbox"></span>
                        زنانه
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="category" value="kids" data-filter="category">
                        <span class="custom-checkbox"></span>
                        بچه‌گانه
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="category" value="accessories" data-filter="category">
                        <span class="custom-checkbox"></span>
                        اکسسوری
                    </label>
                </div>
            </div>
            
            <!-- قیمت -->
            <div class="filter-group">
                <h3>محدوده قیمت</h3>
                <div class="price-inputs">
                    <input type="number" class="price-input" id="minPrice" placeholder="حداقل" min="0" max="1000000" value="0">
                    <span>تا</span>
                    <input type="number" class="price-input" id="maxPrice" placeholder="حداکثر" min="0" max="1000000" value="500000">
                </div>
                <input type="range" class="price-slider" id="priceSlider" min="0" max="1000000" value="500000" step="10000">
                <div style="text-align: center; margin-top: 0.5rem; font-size: 0.9rem; color: var(--gray);">
                    <span id="priceRangeText">تا ۵۰۰,۰۰۰ تومان</span>
                </div>
            </div>
            
            <!-- رنگ -->
            <div class="filter-group">
                <h3>رنگ</h3>
                <div class="color-options">
                    <div class="color-option color-black selected" data-color="black" title="مشکی"></div>
                    <div class="color-option color-white" data-color="white" title="سفید"></div>
                    <div class="color-option color-red" data-color="red" title="قرمز"></div>
                    <div class="color-option color-blue" data-color="blue" title="آبی"></div>
                    <div class="color-option color-green" data-color="green" title="سبز"></div>
                    <div class="color-option color-yellow" data-color="yellow" title="زرد"></div>
                    <div class="color-option color-purple" data-color="purple" title="بنفش"></div>
                    <div class="color-option color-gray" data-color="gray" title="خاکستری"></div>
                    <div class="color-option color-pink" data-color="pink" title="صورتی"></div>
                    <div class="color-option color-brown" data-color="brown" title="قهوه‌ای"></div>
                </div>
            </div>
            
            <!-- سایز -->
            <div class="filter-group">
                <h3>سایز</h3>
                <div class="size-options">
                    <div class="size-option" data-size="xs">XS</div>
                    <div class="size-option" data-size="s">S</div>
                    <div class="size-option selected" data-size="m">M</div>
                    <div class="size-option" data-size="l">L</div>
                    <div class="size-option" data-size="xl">XL</div>
                    <div class="size-option" data-size="xxl">XXL</div>
                </div>
            </div>
            
            <!-- وضعیت -->
            <div class="filter-group">
                <h3>وضعیت محصول</h3>
                <div class="checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="status" value="sale" data-filter="sale">
                        <span class="custom-checkbox"></span>
                        حراج ویژه
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="status" value="new" data-filter="new">
                        <span class="custom-checkbox"></span>
                        محصولات جدید
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="status" value="stock" data-filter="stock">
                        <span class="custom-checkbox"></span>
                        موجود در انبار
                    </label>
                </div>
            </div>
            
            <button class="load-more-btn" style="width: 100%; margin-top: 1rem;" onclick="applyFilters()">
                <i class="fas fa-filter"></i>
                اعمال فیلترها
            </button>
        </aside>
        
        <!-- پنل فیلتر موبایل (اورلی و سایدبار) -->
        <div class="filter-sidebar-mobile-overlay" id="filterMobileOverlay"></div>
        <div class="filter-sidebar-mobile" id="filterSidebarMobile">
            <button class="close-filter-btn" id="closeFilterBtn">
                <i class="fas fa-times"></i>
            </button>
            <div class="filter-header">
                <h2>فیلتر محصولات</h2>
                <button class="clear-filters" id="clearFiltersMobile">
                    پاک کردن
                </button>
            </div>
            
            <!-- دسته‌بندی -->
            <div class="filter-group">
                <h3>دسته‌بندی <span class="filter-count" id="categoryCountMobile">0</span></h3>
                <div class="checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="category-mobile" value="men" data-filter="category">
                        <span class="custom-checkbox"></span>
                        مردانه
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="category-mobile" value="women" data-filter="category">
                        <span class="custom-checkbox"></span>
                        زنانه
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="category-mobile" value="kids" data-filter="category">
                        <span class="custom-checkbox"></span>
                        بچه‌گانه
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="category-mobile" value="accessories" data-filter="category">
                        <span class="custom-checkbox"></span>
                        اکسسوری
                    </label>
                </div>
            </div>
            
            <!-- قیمت -->
            <div class="filter-group">
                <h3>محدوده قیمت</h3>
                <div class="price-inputs">
                    <input type="number" class="price-input" id="minPriceMobile" placeholder="حداقل" min="0" max="1000000" value="0">
                    <span>تا</span>
                    <input type="number" class="price-input" id="maxPriceMobile" placeholder="حداکثر" min="0" max="1000000" value="500000">
                </div>
                <input type="range" class="price-slider" id="priceSliderMobile" min="0" max="1000000" value="500000" step="10000">
                <div style="text-align: center; margin-top: 0.5rem; font-size: 0.9rem; color: var(--gray);">
                    <span id="priceRangeTextMobile">تا ۵۰۰,۰۰۰ تومان</span>
                </div>
            </div>
            
            <!-- رنگ -->
            <div class="filter-group">
                <h3>رنگ</h3>
                <div class="color-options">
                    <div class="color-option color-black selected" data-color="black" title="مشکی"></div>
                    <div class="color-option color-white" data-color="white" title="سفید"></div>
                    <div class="color-option color-red" data-color="red" title="قرمز"></div>
                    <div class="color-option color-blue" data-color="blue" title="آبی"></div>
                    <div class="color-option color-green" data-color="green" title="سبز"></div>
                    <div class="color-option color-yellow" data-color="yellow" title="زرد"></div>
                    <div class="color-option color-purple" data-color="purple" title="بنفش"></div>
                    <div class="color-option color-gray" data-color="gray" title="خاکستری"></div>
                    <div class="color-option color-pink" data-color="pink" title="صورتی"></div>
                    <div class="color-option color-brown" data-color="brown" title="قهوه‌ای"></div>
                </div>
            </div>
            
            <!-- سایز -->
            <div class="filter-group">
                <h3>سایز</h3>
                <div class="size-options">
                    <div class="size-option" data-size="xs">XS</div>
                    <div class="size-option" data-size="s">S</div>
                    <div class="size-option selected" data-size="m">M</div>
                    <div class="size-option" data-size="l">L</div>
                    <div class="size-option" data-size="xl">XL</div>
                    <div class="size-option" data-size="xxl">XXL</div>
                </div>
            </div>
            
            <!-- وضعیت -->
            <div class="filter-group">
                <h3>وضعیت محصول</h3>
                <div class="checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="status-mobile" value="sale" data-filter="sale">
                        <span class="custom-checkbox"></span>
                        حراج ویژه
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="status-mobile" value="new" data-filter="new">
                        <span class="custom-checkbox"></span>
                        محصولات جدید
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="status-mobile" value="stock" data-filter="stock">
                        <span class="custom-checkbox"></span>
                        موجود در انبار
                    </label>
                </div>
            </div>
            
            <button class="load-more-btn" style="width: 100%; margin-top: 1rem;" onclick="applyFiltersMobile()">
                <i class="fas fa-filter"></i>
                اعمال فیلترها
            </button>
        </div>
        
        <!-- بخش محصولات -->
        <section class="products-section">
            <div class="products-header">
                <h1>محصولات پوشاک <span id="productsCount" style="font-size: 1rem; color: var(--gray);">(128 محصول)</span></h1>
                <div class="sorting-options">
                    <div class="view-options">
                        <button class="view-btn active" data-view="grid">
                            <i class="fas fa-th-large"></i>
                        </button>
                        <button class="view-btn" data-view="list">
                            <i class="fas fa-list"></i>
                        </button>
                    </div>
                    <select class="sort-select" id="sortSelect">
                        <option value="newest">جدیدترین</option>
                        <option value="popular">پرفروش‌ترین</option>
                        <option value="price-low">قیمت: کم به زیاد</option>
                        <option value="price-high">قیمت: زیاد به کم</option>
                        <option value="rating">بالاترین امتیاز</option>
                    </select>
                </div>
            </div>
            
            <!-- گرید محصولات -->
            <div class="products-grid" id="productsGrid">
                <!-- محصولات به صورت داینامیک اضافه می‌شوند -->
            </div>
            
            <!-- پینت‌لود -->
            <div class="products-grid" id="skeletonLoader">
                <!-- اسکلت‌لودرها -->
            </div>
            
            <!-- دکمه لود بیشتر -->
            <div class="load-more-container">
                <button class="load-more-btn" id="loadMoreBtn">
                    <i class="fas fa-spinner fa-spin" style="display: none;"></i>
                    بارگذاری محصولات بیشتر
                </button>
            </div>
        </section>
    </main>

    <!-- پنل مقایسه -->
    <div class="compare-panel" id="comparePanel">
        <div class="compare-header">
            <h3>محصولات انتخاب شده برای مقایسه (<span id="comparePanelCount">0</span>)</h3>
            <div>
                <button class="load-more-btn" onclick="openCompareTable()" style="margin-left: 10px;">
                    مشاهده مقایسه
                </button>
                <button class="clear-filters" onclick="clearCompareList()">
                    پاک کردن همه
                </button>
            </div>
        </div>
        <div class="compare-products" id="compareProductsList">
            <!-- محصولات برای مقایسه -->
        </div>
    </div>

    <!-- پنل مشاهده سریع -->
    <div class="quick-view-panel" id="quickViewPanel">
        <div class="quick-view-content">
            <button class="close-quick-view" id="closeQuickView">
                <i class="fas fa-times"></i>
            </button>
            <div id="quickViewContent">
                <!-- محتوای مشاهده سریع -->
            </div>
        </div>
    </div>

    <!-- پنل مقایسه کامل -->
    <div class="quick-view-panel" id="compareTablePanel">
        <div class="quick-view-content" style="max-width: 1200px;">
            <button class="close-quick-view" onclick="closeCompareTable()">
                <i class="fas fa-times"></i>
            </button>
            <div id="compareTableContent" style="padding: 2rem;">
                <!-- جدول مقایسه -->
            </div>
        </div>
    </div>

    <!-- دکمه حالت شب -->
    <div class="dark-mode-toggle" id="darkModeToggle">
        <i class="fas fa-moon"></i>
    </div>

    <script>
        // داده‌های نمونه محصولات
        const productsData = [
            {
                id: 1,
                name: "ژاکت مردانه پشمی زمستانی",
                category: "men",
                price: 239000,
                oldPrice: 290000,
                description: "ژاکت زمستانی با کیفیت بالا، دوخت عالی و پارچه پشمی طبیعی. مناسب برای فصول سرد سال با طراحی کلاسیک و مدرن.",
                colors: ["black", "gray", "blue"],
                sizes: ["m", "l", "xl"],
                image: "https://images.unsplash.com/photo-1595950653106-6c9ebd614d3a?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                badge: "sale",
                rating: 4.5,
                reviews: 42,
                inStock: true,
                isNew: false,
                material: "پشم مرینو",
                features: ["گرم‌کننده", "ضد حساسیت", "دوخت دقیق"]
            },
            {
                id: 2,
                name: "پیراهن زنانه ابریشمی مجلسی",
                category: "women",
                price: 159000,
                oldPrice: 180000,
                description: "پیراهن مجلسی با طراحی مدرن و پارچه ابریشم درجه یک. مناسب مهمانی‌ها و مراسم خاص.",
                colors: ["white", "red", "purple"],
                sizes: ["s", "m", "l"],
                image: "https://images.unsplash.com/photo-1509631179647-0177331693ae?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                badge: "new",
                rating: 4.8,
                reviews: 31,
                inStock: true,
                isNew: true,
                material: "ابریشم طبیعی",
                features: ["ضد چروک", "تنفس‌پذیر", "شستشوی آسان"]
            },
            {
                id: 3,
                name: "کفش ورزشی نایک مدل Air Max",
                category: "men",
                price: 399000,
                oldPrice: 450000,
                description: "کفش ورزشی با کفی ارگونومیک، طراحی مدرن و تنفس پذیری عالی. مناسب ورزش و روزمره.",
                colors: ["black", "white", "blue"],
                sizes: ["m", "l", "xl"],
                image: "https://images.unsplash.com/photo-1544441893-675973e31985?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                badge: "popular",
                rating: 4.7,
                reviews: 89,
                inStock: true,
                isNew: false,
                material: "مش و چرم",
                features: ["ضد عرق", "ضد لغزش", "سبک وزن"]
            },
            {
                id: 4,
                name: "شلوار جین مردانه اسلیم فیت",
                category: "men",
                price: 189000,
                oldPrice: 220000,
                description: "شلوار جین با دوخت اسلیم فیت، جنس کتان مرغوب و رنگ ثابت. مناسب استایل روزمره.",
                colors: ["blue", "black", "gray"],
                sizes: ["xs", "s", "m", "l"],
                image: "https://images.unsplash.com/photo-1542272604-787c3835535d?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                badge: "sale",
                rating: 4.3,
                reviews: 56,
                inStock: true,
                isNew: false,
                material: "کتان با کش",
                features: ["رنگ ثابت", "ضد چروک", "دوام بالا"]
            },
            {
                id: 5,
                name: "لباس مجلسی زنانه شیک",
                category: "women",
                price: 299000,
                oldPrice: 0,
                description: "لباس مجلسی شیک مناسب مهمانی‌های رسمی با طراحی خاص و پارچه ساتن درجه یک.",
                colors: ["black", "red", "purple"],
                sizes: ["s", "m"],
                image: "https://images.unsplash.com/photo-1595777457583-95e059d581b8?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                badge: "new",
                rating: 4.9,
                reviews: 24,
                inStock: true,
                isNew: true,
                material: "ساتن ابریشمی",
                features: ["درخشندگی", "ضد حساسیت", "دوخت دستی"]
            },
            {
                id: 6,
                name: "هودی مردانه پنبه‌ای",
                category: "men",
                price: 129000,
                oldPrice: 150000,
                description: "هودی راحت و نرم از جنس پنبه مرغوب، مناسب فصل سرد و استایل کژوال.",
                colors: ["gray", "black", "green"],
                sizes: ["m", "l", "xl", "xxl"],
                image: "https://static.tagmond.com/products/photos/001/980/388/medium/127253.jpg",
                badge: null,
                rating: 4.4,
                reviews: 67,
                inStock: true,
                isNew: false,
                material: "پنبه 100%",
                features: ["نرمی بالا", "ضد حساسیت", "شستشوی آسان"]
            },
            {
                id: 7,
                name: "کیف دستی زنانه چرم طبیعی",
                category: "accessories",
                price: 275000,
                oldPrice: 320000,
                description: "کیف دستی چرم طبیعی با دوخت دستی و طراحی لوکس. مناسب مهمانی و استفاده روزمره.",
                colors: ["black", "brown"],
                sizes: [],
                image: "https://images.unsplash.com/photo-1584917865442-de89df76afd3?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                badge: "sale",
                rating: 4.6,
                reviews: 38,
                inStock: true,
                isNew: false,
                material: "چرم گاوی",
                features: ["دوخت دستی", "جیب مخفی", "بند قابل تنظیم"]
            },
            {
                id: 8,
                name: "کفش کتانی زنانه سفید",
                category: "women",
                price: 179000,
                oldPrice: 0,
                description: "کفش کتانی سفید با کفی نرم و طراحی مینیمال. مناسب ورزش سبک و استایل روزمره.",
                colors: ["white"],
                sizes: ["s", "m", "l"],
                image: "https://images.unsplash.com/photo-1606107557195-0e29a4b5b4aa?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                badge: "new",
                rating: 4.5,
                reviews: 45,
                inStock: true,
                isNew: true,
                material: "مش و لاستیک",
                features: ["ضد لغزش", "تنفس‌پذیر", "سبک وزن"]
            }
        ];

        // المنت‌های DOM
        const productsGrid = document.getElementById('productsGrid');
        const skeletonLoader = document.getElementById('skeletonLoader');
        const quickViewPanel = document.getElementById('quickViewPanel');
        const quickViewContent = document.getElementById('quickViewContent');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const cartCount = document.getElementById('cartCount');
        const wishlistCount = document.getElementById('wishlistCount');
        const compareCount = document.getElementById('compareCount');
        const filterSidebar = document.getElementById('filterSidebar');
        const filterSidebarMobile = document.getElementById('filterSidebarMobile');
        const filterMobileOverlay = document.getElementById('filterMobileOverlay');
        const mobileFilterMainBtn = document.getElementById('mobileFilterMainBtn');
        const mobileFilterBtnNav = document.getElementById('mobileFilterBtnNav');
        const closeFilterBtn = document.getElementById('closeFilterBtn');
        const clearFiltersBtn = document.getElementById('clearFilters');
        const clearFiltersBtnMobile = document.getElementById('clearFiltersMobile');
        const priceSlider = document.getElementById('priceSlider');
        const minPriceInput = document.getElementById('minPrice');
        const maxPriceInput = document.getElementById('maxPrice');
        const priceRangeText = document.getElementById('priceRangeText');
        const categoryCount = document.getElementById('categoryCount');
        const categoryCountMobile = document.getElementById('categoryCountMobile');
        const sortSelect = document.getElementById('sortSelect');
        const viewBtns = document.querySelectorAll('.view-btn');
        const colorOptions = document.querySelectorAll('.color-option');
        const sizeOptions = document.querySelectorAll('.size-option');
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const navLinks = document.querySelector('.nav-links');
        const searchBox = document.getElementById('searchBox');
        const searchSuggestions = document.getElementById('searchSuggestions');
        const loadMoreBtn = document.getElementById('loadMoreBtn');
        const compareBtn = document.getElementById('compareBtn');
        const comparePanel = document.getElementById('comparePanel');
        const compareProductsList = document.getElementById('compareProductsList');
        const comparePanelCount = document.getElementById('comparePanelCount');
        const wishlistBtn = document.getElementById('wishlistBtn');
        const productsCount = document.getElementById('productsCount');
        const compareTablePanel = document.getElementById('compareTablePanel');
        const compareTableContent = document.getElementById('compareTableContent');
        const sortBtn = document.getElementById('sortBtn');
        const filterBadge = document.getElementById('filterBadge');

        // المنت‌های موبایل
        const priceSliderMobile = document.getElementById('priceSliderMobile');
        const minPriceInputMobile = document.getElementById('minPriceMobile');
        const maxPriceInputMobile = document.getElementById('maxPriceMobile');
        const priceRangeTextMobile = document.getElementById('priceRangeTextMobile');

        // وضعیت فعلی
        let currentCartCount = 3;
        let wishlistItems = [];
        let compareItems = [];
        let selectedColors = new Set(['black']);
        let selectedSizes = new Set(['m']);
        let activeFilters = {
            category: new Set(),
            price: { min: 0, max: 500000 },
            colors: new Set(['black']),
            sizes: new Set(['m']),
            sale: false,
            new: false,
            stock: false
        };
        let displayedProducts = 8;
        let allProducts = [...productsData];
        let currentView = 'grid';

        // راه‌اندازی اولیه
        document.addEventListener('DOMContentLoaded', () => {
            initializePage();
            createSkeletonLoaders();
            setTimeout(() => {
                renderProducts(allProducts.slice(0, displayedProducts));
                updateProductsCount();
            }, 800);
            
            // بارگذاری از localStorage
            loadFromLocalStorage();
            
            // به‌روزرسانی badge فیلتر
            updateFilterBadge();
        });

        // مقداردهی اولیه صفحه
        function initializePage() {
            // تنظیم اسلایدر قیمت (دسکتاپ)
            priceSlider.addEventListener('input', updatePriceRange);
            minPriceInput.addEventListener('change', updatePriceFromInput);
            maxPriceInput.addEventListener('change', updatePriceFromInput);
            
            // تنظیم اسلایدر قیمت (موبایل)
            priceSliderMobile.addEventListener('input', updatePriceRangeMobile);
            minPriceInputMobile.addEventListener('change', updatePriceFromInputMobile);
            maxPriceInputMobile.addEventListener('change', updatePriceFromInputMobile);
            
            // رویدادهای کلیک
            darkModeToggle.addEventListener('click', toggleDarkMode);
            mobileFilterMainBtn.addEventListener('click', openMobileFilter);
            mobileFilterBtnNav.addEventListener('click', openMobileFilter);
            closeFilterBtn.addEventListener('click', closeMobileFilter);
            filterMobileOverlay.addEventListener('click', closeMobileFilter);
            clearFiltersBtn.addEventListener('click', clearAllFilters);
            clearFiltersBtnMobile.addEventListener('click', clearAllFiltersMobile);
            sortSelect.addEventListener('change', sortProducts);
            compareBtn.addEventListener('click', toggleComparePanel);
            wishlistBtn.addEventListener('click', showWishlist);
            loadMoreBtn.addEventListener('click', loadMoreProducts);
            sortBtn.addEventListener('click', () => sortSelect.focus());
            
            // رویدادهای مشاهده سریع
            document.getElementById('closeQuickView').addEventListener('click', closeQuickView);
            quickViewPanel.addEventListener('click', (e) => {
                if (e.target === quickViewPanel) closeQuickView();
            });
            
            // رویدادهای موبایل
            mobileMenuBtn.addEventListener('click', toggleMobileMenu);
            
            // رویدادهای فیلتر رنگ و سایز (دسکتاپ)
            colorOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const color = option.getAttribute('data-color');
                    toggleColorFilter(color, option);
                    // همگام‌سازی با موبایل
                    syncColorFilters();
                    updateFilterBadge();
                });
            });
            
            sizeOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const size = option.getAttribute('data-size');
                    toggleSizeFilter(size, option);
                    // همگام‌سازی با موبایل
                    syncSizeFilters();
                    updateFilterBadge();
                });
            });
            
            // رویدادهای دکمه‌های view
            viewBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    viewBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentView = btn.getAttribute('data-view');
                    changeViewMode(currentView);
                });
            });
            
            // رویدادهای فیلتر موبایل
            document.querySelectorAll('.mobile-filter-btn').forEach(btn => {
                if (btn.id !== 'mobileFilterBtnNav' && btn.id !== 'sortBtn') {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.mobile-filter-btn').forEach(b => {
                            if (b.id !== 'mobileFilterBtnNav' && b.id !== 'sortBtn') {
                                b.classList.remove('active');
                            }
                        });
                        btn.classList.add('active');
                        applyMobileFilter(btn.getAttribute('data-filter'));
                    });
                }
            });
            
            // رویدادهای چک‌باکس‌ها (دسکتاپ)
            document.querySelectorAll('#filterSidebar input[data-filter]').forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    updateFilterCount();
                    updateFilterBadge();
                });
            });
            
            // رویدادهای چک‌باکس‌ها (موبایل)
            document.querySelectorAll('#filterSidebarMobile input[data-filter]').forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    updateFilterCountMobile();
                    updateFilterBadge();
                });
            });
            
            // رویداد جستجو
            searchBox.addEventListener('input', handleSearch);
            searchBox.addEventListener('focus', showSearchSuggestions);
            
            // بستن پیشنهادات جستجو با کلیک بیرون
            document.addEventListener('click', (e) => {
                if (!searchBox.contains(e.target) && !searchSuggestions.contains(e.target)) {
                    searchSuggestions.style.display = 'none';
                }
            });
            
            updatePriceDisplay();
            updatePriceDisplayMobile();
            updateFilterCount();
            updateFilterCountMobile();
            updateComparePanel();
            
            // همگام‌سازی اولیه
            syncFiltersToMobile();
        }

        // به‌روزرسانی badge فیلتر
        function updateFilterBadge() {
            let count = 0;
            
            // شمارش چک‌باکس‌های انتخاب شده (دسکتاپ)
            count += document.querySelectorAll('#filterSidebar input[name="category"]:checked').length;
            count += document.querySelectorAll('#filterSidebar input[name="status"]:checked').length;
            
            // اضافه کردن رنگ‌ها و سایزها
            count += selectedColors.size;
            if (selectedSizes.size > 0) count += 1;
            
            // بررسی محدوده قیمت
            if (parseInt(minPriceInput.value) > 0 || parseInt(maxPriceInput.value) < 1000000) {
                count += 1;
            }
            
            filterBadge.textContent = count;
            filterBadge.style.display = count > 0 ? 'block' : 'none';
        }

        // باز کردن فیلتر موبایل
        function openMobileFilter() {
            filterSidebarMobile.classList.add('active');
            filterMobileOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // بستن فیلتر موبایل
        function closeMobileFilter() {
            filterSidebarMobile.classList.remove('active');
            filterMobileOverlay.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // بارگذاری از localStorage
        function loadFromLocalStorage() {
            const savedWishlist = localStorage.getItem('wishlistItems');
            const savedCompare = localStorage.getItem('compareItems');
            
            if (savedWishlist) {
                wishlistItems = JSON.parse(savedWishlist);
                wishlistCount.textContent = wishlistItems.length;
            }
            
            if (savedCompare) {
                compareItems = JSON.parse(savedCompare);
                compareCount.textContent = compareItems.length;
                comparePanelCount.textContent = compareItems.length;
                updateComparePanel();
            }
        }

        // ذخیره در localStorage
        function saveToLocalStorage() {
            localStorage.setItem('wishlistItems', JSON.stringify(wishlistItems));
            localStorage.setItem('compareItems', JSON.stringify(compareItems));
        }

        // همگام‌سازی فیلترها به موبایل
        function syncFiltersToMobile() {
            // همگام‌سازی دسته‌بندی
            document.querySelectorAll('#filterSidebar input[name="category"]').forEach(checkbox => {
                const mobileCheckbox = document.querySelector(`#filterSidebarMobile input[name="category-mobile"][value="${checkbox.value}"]`);
                if (mobileCheckbox) {
                    mobileCheckbox.checked = checkbox.checked;
                }
            });
            
            // همگام‌سازی وضعیت
            document.querySelectorAll('#filterSidebar input[name="status"]').forEach(checkbox => {
                const mobileCheckbox = document.querySelector(`#filterSidebarMobile input[name="status-mobile"][value="${checkbox.value}"]`);
                if (mobileCheckbox) {
                    mobileCheckbox.checked = checkbox.checked;
                }
            });
            
            // همگام‌سازی قیمت
            minPriceInputMobile.value = minPriceInput.value;
            maxPriceInputMobile.value = maxPriceInput.value;
            priceSliderMobile.value = priceSlider.value;
            
            updateFilterCountMobile();
        }

        // همگام‌سازی فیلترها از موبایل
        function syncFiltersFromMobile() {
            // همگام‌سازی دسته‌بندی
            document.querySelectorAll('#filterSidebarMobile input[name="category-mobile"]').forEach(checkbox => {
                const desktopCheckbox = document.querySelector(`#filterSidebar input[name="category"][value="${checkbox.value}"]`);
                if (desktopCheckbox) {
                    desktopCheckbox.checked = checkbox.checked;
                }
            });
            
            // همگام‌سازی وضعیت
            document.querySelectorAll('#filterSidebarMobile input[name="status-mobile"]').forEach(checkbox => {
                const desktopCheckbox = document.querySelector(`#filterSidebar input[name="status"][value="${checkbox.value}"]`);
                if (desktopCheckbox) {
                    desktopCheckbox.checked = checkbox.checked;
                }
            });
            
            // همگام‌سازی قیمت
            minPriceInput.value = minPriceInputMobile.value;
            maxPriceInput.value = maxPriceInputMobile.value;
            priceSlider.value = priceSliderMobile.value;
            
            updateFilterCount();
        }

        // همگام‌سازی فیلتر رنگ
        function syncColorFilters() {
            // به‌روزرسانی تمامی رنگ‌ها در موبایل
            document.querySelectorAll('.color-option').forEach(option => {
                const color = option.getAttribute('data-color');
                const isSelected = selectedColors.has(color);
                option.classList.toggle('selected', isSelected);
            });
        }

        // همگام‌سازی فیلتر سایز
        function syncSizeFilters() {
            // به‌روزرسانی تمامی سایزها در موبایل
            document.querySelectorAll('.size-option').forEach(option => {
                const size = option.getAttribute('data-size');
                const isSelected = selectedSizes.has(size);
                option.classList.toggle('selected', isSelected);
            });
        }

        // ایجاد اسکلت‌لودرها
        function createSkeletonLoaders() {
            skeletonLoader.innerHTML = '';
            for (let i = 0; i < 4; i++) {
                const skeleton = document.createElement('div');
                skeleton.className = 'product-card skeleton-loader';
                skeleton.innerHTML = `
                    <div class="skeleton-image"></div>
                    <div class="skeleton-text short"></div>
                    <div class="skeleton-text"></div>
                    <div class="skeleton-text" style="width: 40%;"></div>
                `;
                skeletonLoader.appendChild(skeleton);
            }
        }

        // رندر محصولات
        function renderProducts(products) {
            skeletonLoader.style.display = 'none';
            productsGrid.innerHTML = '';
            
            if (products.length === 0) {
                productsGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 3rem; color: var(--gray);">
                        <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                        <h3 style="margin-bottom: 0.5rem;">محصولی یافت نشد</h3>
                        <p>لطفاً فیلترهای جستجو را تغییر دهید یا عبارت دیگری را جستجو کنید.</p>
                    </div>
                `;
                return;
            }
            
            products.forEach(product => {
                const productCard = createProductCard(product);
                productsGrid.appendChild(productCard);
            });
            
            // اعمال view mode فعلی
            changeViewMode(currentView);
        }

        // ایجاد کارت محصول
        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.dataset.id = product.id;
            card.dataset.category = product.category;
            card.dataset.price = product.price;
            
            // تعیین بدج
            let badgeHTML = '';
            if (product.badge === 'sale') {
                badgeHTML = '<div class="product-badge badge-sale">حراج</div>';
            } else if (product.badge === 'new') {
                badgeHTML = '<div class="product-badge badge-new">جدید</div>';
            } else if (product.badge === 'popular') {
                badgeHTML = '<div class="product-badge badge-popular">پرفروش</div>';
            }
            
            // بررسی وضعیت علاقه‌مندی و مقایسه
            const isInWishlist = wishlistItems.includes(product.id);
            const isInCompare = compareItems.includes(product.id);
            
            // ایجاد ستاره‌های رتبه‌بندی
            const stars = createStars(product.rating);
            
            card.innerHTML = `
                <div class="product-image-container">
                    <img src="${product.image}" alt="${product.name}" class="product-image" loading="lazy">
                    <div class="product-badges">
                        ${badgeHTML}
                    </div>
                    <div class="product-actions">
                        <button class="action-btn ${isInWishlist ? 'active' : ''}" onclick="toggleWishlist(${product.id}, this)" title="افزودن به علاقه‌مندی‌ها">
                            <i class="fas fa-heart"></i>
                        </button>
                        <button class="action-btn ${isInCompare ? 'active' : ''}" onclick="toggleCompare(${product.id}, this)" title="افزودن به مقایسه">
                            <i class="fas fa-balance-scale"></i>
                        </button>
                        <a href="ویرایشگر جدید.html?product=${product.id}" class="action-btn" title="سفارشی سازی">
                            <i class="fas fa-paint-brush"></i>
                        </a>
                    </div>
                    <button class="quick-view-btn" onclick="openQuickView(${product.id})">
                        <i class="fas fa-eye"></i> مشاهده سریع
                    </button>
                    <div class="color-palette">
                        ${product.colors.map(color => `
                            <div class="color-palette-item color-${color}" title="${color}" onclick="selectColor('${color}', ${product.id})"></div>
                        `).join('')}
                    </div>
                </div>
                <div class="product-info">
                    <span class="product-category">${getCategoryName(product.category)}</span>
                    <h3 class="product-title">${product.name}</h3>
                    <p class="product-description">${product.description}</p>
                    <div class="product-rating">
                        <div class="stars">${stars}</div>
                        <span class="rating-count">(${product.reviews})</span>
                    </div>
                    <div class="product-footer">
                        <div class="product-price">
                            ${product.oldPrice ? `<span class="old-price">${formatPrice(product.oldPrice)}</span>` : ''}
                            <span class="current-price">${formatPrice(product.price)}</span>
                        </div>
                        <button class="add-to-cart-btn" onclick="addToCart(${product.id}, this)" title="افزودن به سبد خرید">
                            <i class="fas fa-shopping-bag"></i>
                        </button>
                    </div>
                </div>
            `;
            
            return card;
        }

        // ایجاد ستاره‌های رتبه‌بندی
        function createStars(rating) {
            let stars = '';
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            
            for (let i = 1; i <= 5; i++) {
                if (i <= fullStars) {
                    stars += '<i class="fas fa-star"></i>';
                } else if (i === fullStars + 1 && hasHalfStar) {
                    stars += '<i class="fas fa-star-half-alt"></i>';
                } else {
                    stars += '<i class="far fa-star"></i>';
                }
            }
            return stars;
        }

        // فرمت قیمت
        function formatPrice(price) {
            return price.toLocaleString('fa-IR') + ' تومان';
        }

        // نام دسته‌بندی
        function getCategoryName(category) {
            const categories = {
                'men': 'مردانه',
                'women': 'زنانه',
                'kids': 'بچه‌گانه',
                'accessories': 'اکسسوری'
            };
            return categories[category] || category;
        }

        // افزودن به سبد خرید
        function addToCart(productId, button) {
            currentCartCount++;
            cartCount.textContent = currentCartCount;
            
            button.classList.add('added');
            button.innerHTML = '<i class="fas fa-check"></i>';
            
            showNotification('محصول به سبد خرید اضافه شد!');
            
            setTimeout(() => {
                button.classList.remove('added');
                button.innerHTML = '<i class="fas fa-shopping-bag"></i>';
            }, 2000);
        }

        // مدیریت علاقه‌مندی‌ها
        function toggleWishlist(productId, button) {
            const index = wishlistItems.indexOf(productId);
            
            if (index === -1) {
                // افزودن به علاقه‌مندی‌ها
                wishlistItems.push(productId);
                if (button) button.classList.add('active');
                showNotification('به علاقه‌مندی‌ها اضافه شد');
            } else {
                // حذف از علاقه‌مندی‌ها
                wishlistItems.splice(index, 1);
                if (button) button.classList.remove('active');
                showNotification('از علاقه‌مندی‌ها حذف شد');
            }
            
            wishlistCount.textContent = wishlistItems.length;
            saveToLocalStorage();
        }

        // نمایش علاقه‌مندی‌ها
        function showWishlist() {
            if (wishlistItems.length === 0) {
                showNotification('لیست علاقه‌مندی‌های شما خالی است');
                return;
            }
            
            const wishlistProducts = allProducts.filter(p => wishlistItems.includes(p.id));
            renderProducts(wishlistProducts);
            showNotification(`${wishlistProducts.length} محصول در علاقه‌مندی‌ها`);
        }

        // مدیریت مقایسه
        function toggleCompare(productId, button) {
            const index = compareItems.indexOf(productId);
            
            if (index === -1) {
                // بررسی تعداد محصولات در مقایسه
                if (compareItems.length >= 4) {
                    showNotification('حداکثر ۴ محصول را می‌توانید مقایسه کنید', 'warning');
                    return;
                }
                
                // افزودن به مقایسه
                compareItems.push(productId);
                if (button) button.classList.add('active');
                showNotification('به لیست مقایسه اضافه شد');
            } else {
                // حذف از مقایسه
                compareItems.splice(index, 1);
                if (button) button.classList.remove('active');
                showNotification('از لیست مقایسه حذف شد');
            }
            
            compareCount.textContent = compareItems.length;
            comparePanelCount.textContent = compareItems.length;
            updateComparePanel();
            saveToLocalStorage();
            
            // نمایش پنل مقایسه اگر محصولی اضافه شد
            if (compareItems.length > 0 && !comparePanel.classList.contains('active')) {
                comparePanel.classList.add('active');
            }
        }

        // به‌روزرسانی پنل مقایسه
        function updateComparePanel() {
            compareProductsList.innerHTML = '';
            
            if (compareItems.length === 0) {
                comparePanel.classList.remove('active');
                return;
            }
            
            compareItems.forEach(productId => {
                const product = allProducts.find(p => p.id === productId);
                if (!product) return;
                
                const compareProduct = document.createElement('div');
                compareProduct.className = 'compare-product';
                compareProduct.innerHTML = `
                    <button class="remove-compare" onclick="toggleCompare(${productId})">
                        <i class="fas fa-times"></i>
                    </button>
                    <img src="${product.image}" alt="${product.name}">
                    <div style="margin-top: 0.5rem; font-size: 0.85rem;">${product.name}</div>
                    <div style="font-weight: 700; color: var(--primary); font-size: 0.9rem;">${formatPrice(product.price)}</div>
                `;
                compareProductsList.appendChild(compareProduct);
            });
        }

        // باز کردن جدول مقایسه
        function openCompareTable() {
            if (compareItems.length < 2) {
                showNotification('حداقل ۲ محصول برای مقایسه انتخاب کنید', 'warning');
                return;
            }
            
            const compareProducts = allProducts.filter(p => compareItems.includes(p.id));
            
            let tableHTML = `
                <h2 style="margin-bottom: 1.5rem; text-align: center;">مقایسه محصولات</h2>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; min-width: 800px;">
                        <thead>
                            <tr>
                                <th style="padding: 1rem; text-align: right; border-bottom: 2px solid var(--gray-light);">ویژگی</th>
            `;
            
            // هدر جدول - نام محصولات
            compareProducts.forEach(product => {
                tableHTML += `
                    <th style="padding: 1rem; text-align: center; border-bottom: 2px solid var(--gray-light);">
                        <img src="${product.image}" alt="${product.name}" style="width: 100px; height: 100px; object-fit: cover; border-radius: var(--radius-sm); margin-bottom: 0.5rem;">
                        <div>${product.name}</div>
                        <div style="font-weight: 700; color: var(--primary); margin-top: 0.5rem;">${formatPrice(product.price)}</div>
                        <button class="load-more-btn" style="margin-top: 0.5rem; padding: 0.4rem 0.8rem; font-size: 0.8rem;" onclick="addToCart(${product.id})">
                            <i class="fas fa-shopping-bag"></i> خرید
                        </button>
                    </th>
                `;
            });
            
            tableHTML += `</tr></thead><tbody>`;
            
            // ردیف‌های مقایسه
            const features = [
                { title: 'دسته‌بندی', key: 'category', format: getCategoryName },
                { title: 'امتیاز', key: 'rating', format: (val) => `${val} از ۵` },
                { title: 'تعداد نظرات', key: 'reviews' },
                { title: 'جنس پارچه', key: 'material' },
                { title: 'ویژگی‌ها', key: 'features', format: (val) => val.join('، ') },
                { title: 'وضعیت', key: 'inStock', format: (val) => val ? 'موجود' : 'ناموجود' }
            ];
            
            features.forEach(feature => {
                tableHTML += `<tr><td style="padding: 1rem; border-bottom: 1px solid var(--gray-light); font-weight: 600;">${feature.title}</td>`;
                
                compareProducts.forEach(product => {
                    const value = product[feature.key];
                    const formattedValue = feature.format ? feature.format(value) : value;
                    tableHTML += `<td style="padding: 1rem; border-bottom: 1px solid var(--gray-light); text-align: center;">${formattedValue || '-'}</td>`;
                });
                
                tableHTML += `</tr>`;
            });
            
            tableHTML += `</tbody></table></div>`;
            
            compareTableContent.innerHTML = tableHTML;
            compareTablePanel.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // بستن جدول مقایسه
        function closeCompareTable() {
            compareTablePanel.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // پاک کردن لیست مقایسه
        function clearCompareList() {
            compareItems = [];
            compareCount.textContent = '0';
            comparePanelCount.textContent = '0';
            updateComparePanel();
            saveToLocalStorage();
            
            // به‌روزرسانی دکمه‌های محصولات
            document.querySelectorAll('.product-actions .action-btn:nth-child(2)').forEach(btn => {
                btn.classList.remove('active');
            });
            
            showNotification('لیست مقایسه پاک شد');
        }

        // باز کردن مشاهده سریع
        function openQuickView(productId) {
            const product = allProducts.find(p => p.id === productId);
            if (!product) return;
            
            quickViewContent.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; padding: 1.5rem;">
                    <div>
                        <img src="${product.image}" alt="${product.name}" style="width: 100%; border-radius: var(--radius);">
                    </div>
                    <div>
                        <h2 style="margin-bottom: 1rem; font-size: 1.5rem;">${product.name}</h2>
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div class="product-rating">
                                <div class="stars">${createStars(product.rating)}</div>
                                <span class="rating-count">${product.reviews} نظر</span>
                            </div>
                            <span style="color: var(--success); font-weight: 600;">${product.inStock ? 'موجود در انبار' : 'ناموجود'}</span>
                        </div>
                        <p style="margin-bottom: 1.5rem; color: var(--dark-light); line-height: 1.8;">${product.description}</p>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <h3 style="margin-bottom: 0.5rem;">رنگ‌ها:</h3>
                            <div style="display: flex; gap: 0.5rem;">
                                ${product.colors.map(color => `
                                    <div class="color-option color-${color}" title="${color}"></div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <h3 style="margin-bottom: 0.5rem;">سایز‌ها:</h3>
                            <div style="display: flex; gap: 0.5rem;">
                                ${product.sizes.map(size => `
                                    <div class="size-option">${size.toUpperCase()}</div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 2rem; margin-top: 2rem;">
                            <div>
                                ${product.oldPrice ? `<div style="color: var(--gray); text-decoration: line-through; font-size: 1rem;">${formatPrice(product.oldPrice)}</div>` : ''}
                                <div style="font-size: 1.8rem; font-weight: 800; color: var(--primary);">${formatPrice(product.price)}</div>
                            </div>
                            <button class="load-more-btn" style="flex: 1; max-width: 200px;" onclick="addToCart(${product.id})">
                                <i class="fas fa-shopping-bag"></i>
                                افزودن به سبد خرید
                            </button>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                            <button class="action-btn ${wishlistItems.includes(product.id) ? 'active' : ''}" onclick="toggleWishlist(${product.id})" style="width: auto; padding: 0.5rem 1rem; border-radius: var(--radius-sm);">
                                <i class="fas fa-heart"></i>
                                ${wishlistItems.includes(product.id) ? 'حذف از علاقه‌مندی‌ها' : 'افزودن به علاقه‌مندی‌ها'}
                            </button>
                            <button class="action-btn ${compareItems.includes(product.id) ? 'active' : ''}" onclick="toggleCompare(${product.id})" style="width: auto; padding: 0.5rem 1rem; border-radius: var(--radius-sm);">
                                <i class="fas fa-balance-scale"></i>
                                ${compareItems.includes(product.id) ? 'حذف از مقایسه' : 'افزودن به مقایسه'}
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            quickViewPanel.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // بستن مشاهده سریع
        function closeQuickView() {
            quickViewPanel.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // نمایش نوتیفیکیشن
        function showNotification(message, type = 'success') {
            // حذف نوتیفیکیشن قبلی
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => existingNotification.remove(), 300);
            }
            
            const notification = document.createElement('div');
            notification.className = 'notification';
            
            let icon = 'fa-check-circle';
            if (type === 'warning') icon = 'fa-exclamation-triangle';
            if (type === 'error') icon = 'fa-times-circle';
            
            notification.innerHTML = `
                <i class="fas ${icon}" style="margin-left: 10px;"></i>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // تغییر حالت تاریک/روشن
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const icon = darkModeToggle.querySelector('i');
            icon.classList.toggle('fa-moon');
            icon.classList.toggle('fa-sun');
            
            // ذخیره در localStorage
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        }

        // بررسی حالت تاریک ذخیره شده
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
            const icon = darkModeToggle.querySelector('i');
            icon.classList.remove('fa-moon');
            icon.classList.add('fa-sun');
        }

        // به‌روزرسانی محدوده قیمت (دسکتاپ)
        function updatePriceRange() {
            const value = parseInt(priceSlider.value);
            maxPriceInput.value = value;
            activeFilters.price.max = value;
            updatePriceDisplay();
            updateFilterBadge();
        }

        function updatePriceFromInput() {
            const min = parseInt(minPriceInput.value) || 0;
            const max = parseInt(maxPriceInput.value) || 500000;
            
            activeFilters.price.min = min;
            activeFilters.price.max = max;
            priceSlider.value = max;
            updatePriceDisplay();
            updateFilterBadge();
        }

        function updatePriceDisplay() {
            const max = parseInt(priceSlider.value);
            priceRangeText.textContent = `تا ${max.toLocaleString('fa-IR')} تومان`;
        }

        // به‌روزرسانی محدوده قیمت (موبایل)
        function updatePriceRangeMobile() {
            const value = parseInt(priceSliderMobile.value);
            maxPriceInputMobile.value = value;
            updatePriceDisplayMobile();
            updateFilterBadge();
        }

        function updatePriceFromInputMobile() {
            const min = parseInt(minPriceInputMobile.value) || 0;
            const max = parseInt(maxPriceInputMobile.value) || 500000;
            
            priceSliderMobile.value = max;
            updatePriceDisplayMobile();
            updateFilterBadge();
        }

        function updatePriceDisplayMobile() {
            const max = parseInt(priceSliderMobile.value);
            priceRangeTextMobile.textContent = `تا ${max.toLocaleString('fa-IR')} تومان`;
        }

        // پاک کردن همه فیلترها (دسکتاپ)
        function clearAllFilters() {
            // ریست چک‌باکس‌ها
            document.querySelectorAll('#filterSidebar input[type="checkbox"]').forEach(cb => cb.checked = false);
            
            // ریست رنگ‌ها
            colorOptions.forEach(option => option.classList.remove('selected'));
            selectedColors.clear();
            selectedColors.add('black');
            document.querySelector('.color-option[data-color="black"]').classList.add('selected');
            
            // ریست سایزها
            sizeOptions.forEach(option => option.classList.remove('selected'));
            selectedSizes.clear();
            selectedSizes.add('m');
            document.querySelector('.size-option[data-size="m"]').classList.add('selected');
            
            // ریست قیمت
            minPriceInput.value = 0;
            maxPriceInput.value = 500000;
            priceSlider.value = 500000;
            activeFilters.price = { min: 0, max: 500000 };
            
            // ریست فیلترها
            activeFilters.category.clear();
            activeFilters.colors.clear();
            activeFilters.colors.add('black');
            activeFilters.sizes.clear();
            activeFilters.sizes.add('m');
            activeFilters.sale = false;
            activeFilters.new = false;
            activeFilters.stock = false;
            
            updatePriceDisplay();
            updateFilterCount();
            renderProducts(allProducts.slice(0, displayedProducts));
            updateProductsCount();
            
            // همگام‌سازی با موبایل
            syncFiltersToMobile();
            updateFilterBadge();
            
            showNotification('همه فیلترها پاک شدند');
        }

        // پاک کردن همه فیلترها (موبایل)
        function clearAllFiltersMobile() {
            // ریست چک‌باکس‌ها
            document.querySelectorAll('#filterSidebarMobile input[type="checkbox"]').forEach(cb => cb.checked = false);
            
            // ریست رنگ‌ها
            colorOptions.forEach(option => option.classList.remove('selected'));
            selectedColors.clear();
            selectedColors.add('black');
            document.querySelector('.color-option[data-color="black"]').classList.add('selected');
            
            // ریست سایزها
            sizeOptions.forEach(option => option.classList.remove('selected'));
            selectedSizes.clear();
            selectedSizes.add('m');
            document.querySelector('.size-option[data-size="m"]').classList.add('selected');
            
            // ریست قیمت
            minPriceInputMobile.value = 0;
            maxPriceInputMobile.value = 500000;
            priceSliderMobile.value = 500000;
            activeFilters.price = { min: 0, max: 500000 };
            
            // ریست فیلترها
            activeFilters.category.clear();
            activeFilters.colors.clear();
            activeFilters.colors.add('black');
            activeFilters.sizes.clear();
            activeFilters.sizes.add('m');
            activeFilters.sale = false;
            activeFilters.new = false;
            activeFilters.stock = false;
            
            updatePriceDisplayMobile();
            updateFilterCountMobile();
            
            // همگام‌سازی با دسکتاپ
            syncFiltersFromMobile();
            updateFilterBadge();
            
            showNotification('همه فیلترها پاک شدند');
        }

        // اعمال فیلترها
        function applyFilters() {
            // جمع‌آوری فیلترهای فعال از دسکتاپ
            syncFiltersFromMobile();
            collectActiveFilters();
            
            // فیلتر کردن و نمایش محصولات
            filterAndDisplayProducts();
            
            // بستن پنل موبایل اگر باز است
            if (window.innerWidth <= 992) {
                closeMobileFilter();
            }
        }

        // اعمال فیلترها از موبایل
        function applyFiltersMobile() {
            // جمع‌آوری فیلترهای فعال از موبایل
            syncFiltersFromMobile();
            collectActiveFilters();
            
            // فیلتر کردن و نمایش محصولات
            filterAndDisplayProducts();
            
            // بستن پنل موبایل
            closeMobileFilter();
        }

        // جمع‌آوری فیلترهای فعال
        function collectActiveFilters() {
            activeFilters.category.clear();
            document.querySelectorAll('input[name="category"]:checked').forEach(cb => {
                activeFilters.category.add(cb.value);
            });
            
            activeFilters.sale = document.querySelector('input[name="status"][value="sale"]').checked;
            activeFilters.new = document.querySelector('input[name="status"][value="new"]').checked;
            activeFilters.stock = document.querySelector('input[name="status"][value="stock"]').checked;
            activeFilters.colors = new Set(selectedColors);
            activeFilters.sizes = new Set(selectedSizes);
            
            // به‌روزرسانی قیمت
            const min = parseInt(minPriceInput.value) || 0;
            const max = parseInt(maxPriceInput.value) || 500000;
            activeFilters.price = { min, max };
        }

        // فیلتر کردن و نمایش محصولات
        function filterAndDisplayProducts() {
            // فیلتر کردن محصولات
            let filteredProducts = allProducts.filter(product => {
                // فیلتر دسته‌بندی
                if (activeFilters.category.size > 0 && !activeFilters.category.has(product.category)) {
                    return false;
                }
                
                // فیلتر قیمت
                if (product.price < activeFilters.price.min || product.price > activeFilters.price.max) {
                    return false;
                }
                
                // فیلتر رنگ
                if (activeFilters.colors.size > 0) {
                    const hasColor = product.colors.some(color => activeFilters.colors.has(color));
                    if (!hasColor) return false;
                }
                
                // فیلتر سایز
                if (activeFilters.sizes.size > 0 && product.sizes.length > 0) {
                    const hasSize = product.sizes.some(size => activeFilters.sizes.has(size));
                    if (!hasSize) return false;
                }
                
                // فیلتر حراج
                if (activeFilters.sale && product.badge !== 'sale') {
                    return false;
                }
                
                // فیلتر جدید
                if (activeFilters.new && !product.isNew) {
                    return false;
                }
                
                // فیلتر موجودی
                if (activeFilters.stock && !product.inStock) {
                    return false;
                }
                
                return true;
            });
            
            displayedProducts = 8;
            renderProducts(filteredProducts.slice(0, displayedProducts));
            updateProductsCount(filteredProducts.length);
            
            showNotification(`${filteredProducts.length} محصول یافت شد`);
        }

        // تغییر فیلتر رنگ
        function toggleColorFilter(color, element) {
            if (selectedColors.has(color)) {
                selectedColors.delete(color);
                element.classList.remove('selected');
            } else {
                selectedColors.add(color);
                element.classList.add('selected');
            }
            updateFilterCount();
        }

        // تغییر فیلتر سایز
        function toggleSizeFilter(size, element) {
            if (selectedSizes.has(size)) {
                selectedSizes.delete(size);
                element.classList.remove('selected');
            } else {
                selectedSizes.clear();
                selectedSizes.add(size);
                sizeOptions.forEach(opt => opt.classList.remove('selected'));
                element.classList.add('selected');
            }
            updateFilterCount();
        }

        // به‌روزرسانی تعداد فیلترهای فعال (دسکتاپ)
        function updateFilterCount() {
            let count = 0;
            
            // شمارش چک‌باکس‌های انتخاب شده
            count += document.querySelectorAll('#filterSidebar input[name="category"]:checked').length;
            count += document.querySelectorAll('#filterSidebar input[name="status"]:checked').length;
            
            // اضافه کردن رنگ‌ها و سایزها
            count += selectedColors.size;
            if (selectedSizes.size > 0) count += 1;
            
            // بررسی محدوده قیمت
            if (parseInt(minPriceInput.value) > 0 || parseInt(maxPriceInput.value) < 1000000) {
                count += 1;
            }
            
            categoryCount.textContent = count;
        }

        // به‌روزرسانی تعداد فیلترهای فعال (موبایل)
        function updateFilterCountMobile() {
            let count = 0;
            
            // شمارش چک‌باکس‌های انتخاب شده
            count += document.querySelectorAll('#filterSidebarMobile input[name="category-mobile"]:checked').length;
            count += document.querySelectorAll('#filterSidebarMobile input[name="status-mobile"]:checked').length;
            
            // اضافه کردن رنگ‌ها و سایزها (همان مقادیر)
            count += selectedColors.size;
            if (selectedSizes.size > 0) count += 1;
            
            // بررسی محدوده قیمت
            if (parseInt(minPriceInputMobile.value) > 0 || parseInt(maxPriceInputMobile.value) < 1000000) {
                count += 1;
            }
            
            categoryCountMobile.textContent = count;
        }

        // به‌روزرسانی تعداد محصولات
        function updateProductsCount(count = null) {
            if (count !== null) {
                productsCount.textContent = `(${count} محصول)`;
            } else {
                const currentProducts = productsGrid.querySelectorAll('.product-card').length;
                productsCount.textContent = `(${currentProducts} محصول)`;
            }
        }

        // مرتب‌سازی محصولات
        function sortProducts() {
            const sortBy = sortSelect.value;
            let sortedProducts = [...allProducts];
            
            switch (sortBy) {
                case 'newest':
                    sortedProducts.sort((a, b) => b.id - a.id);
                    break;
                case 'popular':
                    sortedProducts.sort((a, b) => b.rating - a.rating || b.reviews - a.reviews);
                    break;
                case 'price-low':
                    sortedProducts.sort((a, b) => a.price - b.price);
                    break;
                case 'price-high':
                    sortedProducts.sort((a, b) => b.price - a.price);
                    break;
                case 'rating':
                    sortedProducts.sort((a, b) => b.rating - a.rating);
                    break;
            }
            
            allProducts = sortedProducts;
            renderProducts(sortedProducts.slice(0, displayedProducts));
            showNotification(`مرتب‌سازی بر اساس ${sortSelect.options[sortSelect.selectedIndex].text}`);
        }

        // تغییر حالت نمایش
        function changeViewMode(mode) {
            productsGrid.classList.toggle('list-view', mode === 'list');
            
            // اضافه کردن کلاس list-view به کارت‌ها
            document.querySelectorAll('.product-card').forEach(card => {
                if (mode === 'list') {
                    card.classList.add('list-view');
                } else {
                    card.classList.remove('list-view');
                }
            });
        }

        // اعمال فیلتر موبایل
        function applyMobileFilter(filter) {
            if (filter === 'all') {
                renderProducts(allProducts.slice(0, displayedProducts));
                updateProductsCount(allProducts.length);
            } else if (filter === 'men' || filter === 'women') {
                const filtered = allProducts.filter(p => p.category === filter);
                renderProducts(filtered.slice(0, displayedProducts));
                updateProductsCount(filtered.length);
            } else if (filter === 'sale') {
                const filtered = allProducts.filter(p => p.badge === 'sale');
                renderProducts(filtered.slice(0, displayedProducts));
                updateProductsCount(filtered.length);
            }
        }

        // باز/بستن منوی موبایل
        function toggleMobileMenu() {
            navLinks.classList.toggle('active');
            if (navLinks.classList.contains('active')) {
                navLinks.style.right = '0';
            } else {
                navLinks.style.right = '-100%';
            }
        }

        // مدیریت جستجو
        function handleSearch() {
            const query = searchBox.value.trim().toLowerCase();
            
            if (query.length === 0) {
                searchSuggestions.style.display = 'none';
                renderProducts(allProducts.slice(0, displayedProducts));
                updateProductsCount(allProducts.length);
                return;
            }
            
            // فیلتر کردن محصولات بر اساس جستجو
            const filtered = allProducts.filter(product => 
                product.name.toLowerCase().includes(query) || 
                product.description.toLowerCase().includes(query) ||
                getCategoryName(product.category).toLowerCase().includes(query)
            );
            
            // نمایش پیشنهادات
            showSearchSuggestions(filtered.slice(0, 5));
            
            // نمایش نتایج جستجو
            if (query.length >= 2) {
                displayedProducts = 8;
                renderProducts(filtered.slice(0, displayedProducts));
                updateProductsCount(filtered.length);
                
                if (filtered.length === 0) {
                    showNotification(`هیچ محصولی با عبارت "${query}" یافت نشد`, 'warning');
                }
            }
        }

        // نمایش پیشنهادات جستجو
        function showSearchSuggestions(products = []) {
            if (products.length === 0) {
                // پیشنهادات پیش‌فرض
                const suggestions = ['ژاکت', 'پیراهن', 'کفش', 'شلوار', 'هودی', 'کیف'];
                searchSuggestions.innerHTML = suggestions.map(item => `
                    <div class="search-suggestion-item" onclick="setSearchQuery('${item}')">
                        <i class="fas fa-search" style="margin-left: 10px; opacity: 0.5;"></i>
                        ${item}
                    </div>
                `).join('');
            } else {
                searchSuggestions.innerHTML = products.map(product => `
                    <div class="search-suggestion-item" onclick="openQuickView(${product.id}); searchBox.value = ''; searchSuggestions.style.display = 'none';">
                        <img src="${product.image}" style="width: 40px; height: 40px; object-fit: cover; border-radius: var(--radius-sm); margin-left: 10px;">
                        <div>
                            <div style="font-weight: 600;">${product.name}</div>
                            <div style="font-size: 0.85rem; color: var(--gray);">${formatPrice(product.price)}</div>
                        </div>
                    </div>
                `).join('');
            }
            
            searchSuggestions.style.display = 'block';
        }

        // تنظیم عبارت جستجو
        function setSearchQuery(query) {
            searchBox.value = query;
            searchBox.focus();
            handleSearch();
        }

        // انتخاب رنگ از پالت
        function selectColor(color, productId) {
            showNotification(`رنگ ${color} انتخاب شد`);
            // می‌توانید اینجا منطق تغییر رنگ محصول را اضافه کنید
        }

        // بارگذاری محصولات بیشتر
        function loadMoreProducts() {
            const spinner = loadMoreBtn.querySelector('.fa-spinner');
            spinner.style.display = 'inline-block';
            loadMoreBtn.classList.add('loading');
            loadMoreBtn.disabled = true;
            
            // شبیه‌سازی بارگذاری
            setTimeout(() => {
                displayedProducts += 4;
                
                // فیلتر کردن محصولات
                let filteredProducts = allProducts.filter(product => {
                    if (activeFilters.category.size > 0 && !activeFilters.category.has(product.category)) {
                        return false;
                    }
                    if (product.price < activeFilters.price.min || product.price > activeFilters.price.max) {
                        return false;
                    }
                    if (activeFilters.colors.size > 0) {
                        const hasColor = product.colors.some(color => activeFilters.colors.has(color));
                        if (!hasColor) return false;
                    }
                    if (activeFilters.sizes.size > 0 && product.sizes.length > 0) {
                        const hasSize = product.sizes.some(size => activeFilters.sizes.has(size));
                        if (!hasSize) return false;
                    }
                    if (activeFilters.sale && product.badge !== 'sale') return false;
                    if (activeFilters.new && !product.isNew) return false;
                    if (activeFilters.stock && !product.inStock) return false;
                    return true;
                });
                
                renderProducts(filteredProducts.slice(0, displayedProducts));
                updateProductsCount(filteredProducts.length);
                
                // مخفی کردن دکمه اگر همه محصولات نمایش داده شده‌اند
                if (displayedProducts >= filteredProducts.length) {
                    loadMoreBtn.style.display = 'none';
                }
                
                spinner.style.display = 'none';
                loadMoreBtn.classList.remove('loading');
                loadMoreBtn.disabled = false;
                
                showNotification(`${Math.min(displayedProducts, filteredProducts.length)} از ${filteredProducts.length} محصول نمایش داده می‌شود`);
            }, 1000);
        }

        // بستن منوها با کلیک بیرون
        document.addEventListener('click', (e) => {
            // بستن منوی موبایل
            if (!mobileMenuBtn.contains(e.target) && !navLinks.contains(e.target)) {
                navLinks.classList.remove('active');
                navLinks.style.right = '-100%';
            }
        });

        // مدیریت تغییر اندازه پنجره
        window.addEventListener('resize', () => {
            if (window.innerWidth > 992) {
                // در دسکتاپ
                filterSidebar.style.display = 'block';
                navLinks.style.display = 'flex';
                navLinks.classList.remove('active');
                navLinks.style.right = 'auto';
                
                // بستن پنل موبایل اگر باز است
                closeMobileFilter();
            } else {
                // در موبایل
                filterSidebar.style.display = 'none';
                navLinks.style.display = 'none';
            }
            
            // به‌روزرسانی view mode
            changeViewMode(currentView);
        });

        // اسکرول نرم برای تگ‌ها
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                if (targetId === '#') return;
                
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 80,
                        behavior: 'smooth'
                    });
                }
            });
        });
    </script>
</body>
</html>